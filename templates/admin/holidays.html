{% extends "base.html" %}
{% block title %}Feiertage verwalten – Erfassung{% endblock %}
{% block content %}
{% set admin_active = 'holidays' %}
{% include "admin/_nav.html" %}
<section class="card">
    <div class="card-header">
        <h1>Feiertage verwalten</h1>
    </div>
    <div class="card-body card-body--form card-body--separated">
        <form method="get" action="/admin/holidays" class="filter-bar">
            <label>
                Bundesland
                <select name="state">
                    {% for code, label in holiday_states %}
                        <option value="{{ code }}" {% if selected_state == code %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </label>
            <label>
                Jahr
                <select name="holiday_year">
                    {% for year_option in holiday_year_options %}
                        <option value="{{ year_option }}" {% if selected_year == year_option %}selected{% endif %}>{{ year_option }}</option>
                    {% endfor %}
                </select>
            </label>
            <button type="submit" class="button small">Anzeigen</button>
        </form>
        <div class="holiday-actions">
            <form method="post" action="/admin/holidays/sync" class="inline-form">
                <input type="hidden" name="state" value="{{ selected_state }}">
                <label>
                    Jahr synchronisieren
                    <select name="year" required>
                        {% for year_option in holiday_year_options %}
                            <option value="{{ year_option }}" {% if selected_year == year_option %}selected{% endif %}>{{ year_option }}</option>
                        {% endfor %}
                    </select>
                </label>
                <button type="submit" class="button small">Feiertage laden</button>
            </form>
            <form method="post" action="/admin/holidays/create" class="holiday-form">
                <input type="hidden" name="state" value="{{ selected_state }}">
                <div class="holiday-form__grid">
                    <label>
                        Datum
                        <input type="date" name="holiday_date" required>
                    </label>
                    <label>
                        Feiertagstitel
                        <input type="text" name="name" placeholder="z. B. Stadtfest" required>
                    </label>
                    <label>
                        Region (optional)
                        <input type="text" name="region" placeholder="z. B. Stadt oder Landkreis">
                    </label>
                </div>
                <div class="holiday-form__actions">
                    <button type="submit" class="button small">Feiertag hinzufügen</button>
                </div>
            </form>
        </div>
        <div class="table-scroll">
        <table class="striped-table">
            <thead>
            <tr>
                <th>Datum</th>
                <th>Name</th>
                <th>Region</th>
                <th>Aktionen</th>
            </tr>
            </thead>
            <tbody>
            {% for holiday in holidays %}
                <tr>
                    <td>{{ holiday.date.strftime('%d.%m.%Y') }}</td>
                    <td>{{ holiday.name }}</td>
                    <td>{{ holiday.region }}</td>
                    <td>
                        <form method="post" action="/admin/holidays/{{ holiday.id }}/delete" class="inline-form" onsubmit="return confirm('Feiertag wirklich löschen?');">
                            <input type="hidden" name="state" value="{{ selected_state }}">
                            <input type="hidden" name="year" value="{{ selected_year }}">
                            <button type="submit" class="button danger small">Löschen</button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr><td colspan="4">Keine Feiertage gefunden. Bitte Synchronisation ausführen.</td></tr>
            {% endfor %}
            </tbody>
        </table>
        </div>
    </div>
</section>
{% endblock %}
