{% extends "base.html" %}
{% block title %}Feiertage verwalten – Erfassung{% endblock %}
{% block content %}
{% set admin_active = 'holidays' %}
{% include "admin/_nav.html" %}
<section class="card">
    <div class="card-header">
        <h1>Feiertage verwalten</h1>
    </div>
    <form method="get" action="/admin/holidays" class="filter-bar">
        <label>
            Bundesland
            <select name="state">
                {% for code, label in holiday_states %}
                    <option value="{{ code }}" {% if selected_state == code %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </label>
        <label>
            Jahr
            <input type="number" name="holiday_year" value="{{ selected_year }}" min="2000" max="2100">
        </label>
        <button type="submit" class="button small">Anzeigen</button>
    </form>
    <div class="holiday-actions">
        <form method="post" action="/admin/holidays/sync" class="inline-form">
            <input type="hidden" name="state" value="{{ selected_state }}">
            <label>
                Jahr synchronisieren
                <input type="number" name="year" value="{{ selected_year }}" min="2000" max="2100" required>
            </label>
            <button type="submit" class="button small">Feiertage laden</button>
        </form>
        <form method="post" action="/admin/holidays/create" class="user-form">
            <input type="hidden" name="state" value="{{ selected_state }}">
            <input type="date" name="holiday_date" required>
            <input type="text" name="name" placeholder="Feiertagsbezeichnung" required>
            <button type="submit" class="button small">Feiertag hinzufügen</button>
        </form>
    </div>
    <div class="table-scroll">
        <table class="striped-table">
            <thead>
            <tr>
                <th>Datum</th>
                <th>Name</th>
                <th>Region</th>
                <th>Aktionen</th>
            </tr>
            </thead>
            <tbody>
            {% for holiday in holidays %}
                <tr>
                    <td>{{ holiday.date.strftime('%d.%m.%Y') }}</td>
                    <td>{{ holiday.name }}</td>
                    <td>{{ holiday.region }}</td>
                    <td>
                        <form method="post" action="/admin/holidays/{{ holiday.id }}/delete" class="inline-form" onsubmit="return confirm('Feiertag wirklich löschen?');">
                            <input type="hidden" name="state" value="{{ selected_state }}">
                            <input type="hidden" name="year" value="{{ selected_year }}">
                            <button type="submit" class="button danger small">Löschen</button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr><td colspan="4">Keine Feiertage gefunden. Bitte Synchronisation ausführen.</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}
