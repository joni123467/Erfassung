{% extends "base.html" %}
{% block title %}Gruppenverwaltung – Erfassung{% endblock %}
{% block content %}
{% set admin_active = 'groups' %}
{% include "admin/_nav.html" %}
<section class="card">
    <div class="card-header">
        <h1>Gruppenverwaltung</h1>
        <a href="/admin/groups/new" class="button">Neue Gruppe anlegen</a>
    </div>
    <div class="table-scroll">
        <table class="striped-table">
            <thead>
            <tr>
                <th>Name</th>
                <th>Berechtigungen</th>
                <th>Benutzer</th>
                <th>Aktionen</th>
            </tr>
            </thead>
            <tbody>
            {% for group in groups %}
                <tr>
                    <td>{{ group.name }}</td>
                    <td>
                        {% if group.is_admin %}
                            Administrator (alle Rechte)
                        {% else %}
                            {% set perms = namespace(items=[]) %}
                            {% if group.can_manage_users %}{% set _ = perms.items.append('Benutzerverwaltung') %}{% endif %}
                            {% if group.can_manage_vacations %}{% set _ = perms.items.append('Urlaubsverwaltung') %}{% endif %}
                            {% if group.can_approve_manual_entries %}{% set _ = perms.items.append('Manuelle Buchungen') %}{% endif %}
                            {% if group.can_create_companies %}{% set _ = perms.items.append('Firmen anlegen') %}{% endif %}
                            {{ perms.items|join(', ') if perms.items else 'Keine zusätzlichen Rechte' }}
                        {% endif %}
                    </td>
                    <td>{{ group.users|length }}</td>
                    <td>
                        <a class="button small" href="/admin/groups/{{ group.id }}">Bearbeiten</a>
                    </td>
                </tr>
            {% else %}
                <tr><td colspan="4">Noch keine Gruppen vorhanden.</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}
