{% extends "base.html" %}
{% block title %}Administration – Erfassung{% endblock %}
{% block content %}
<section class="card">
    <h1>Gruppenverwaltung</h1>
    <table class="admin-table">
        <thead>
        <tr>
            <th>Bezeichnung</th>
            <th>Rolle</th>
            <th>Aktionen</th>
        </tr>
        </thead>
        <tbody>
        {% for group in groups %}
            <tr>
                <td>
                    <form method="post" action="/admin/groups/{{ group.id }}/update" class="inline-form">
                        <input type="text" name="name" value="{{ group.name }}" required>
                        <label class="checkbox">
                            <input type="checkbox" name="is_admin" {% if group.is_admin %}checked{% endif %}>
                            Administrator
                        </label>
                        <button type="submit" class="button small">Speichern</button>
                    </form>
                </td>
                <td>{{ 'Administrator' if group.is_admin else 'Standard' }}</td>
                <td>
                    <form method="post" action="/admin/groups/{{ group.id }}/delete" onsubmit="return confirm('Gruppe wirklich löschen? Zugeordnete Nutzer müssen vorher entfernt werden.');">
                        <button type="submit" class="button danger small">Löschen</button>
                    </form>
                </td>
            </tr>
        {% else %}
            <tr><td colspan="3">Keine Gruppen vorhanden.</td></tr>
        {% endfor %}
        </tbody>
    </table>
    <h2>Neue Gruppe anlegen</h2>
    <form method="post" action="/admin/groups/create" class="inline-form">
        <input type="text" name="name" placeholder="Gruppenname" required>
        <label class="checkbox">
            <input type="checkbox" name="is_admin">
            Administratorrechte
        </label>
        <button type="submit" class="button primary">Gruppe erstellen</button>
    </form>
</section>

<section class="card">
    <h1>Benutzerverwaltung</h1>
    <table class="admin-table">
        <thead>
        <tr>
            <th>Name</th>
            <th>Login-PIN</th>
            <th>Email</th>
            <th>Gruppe</th>
            <th>Standardzeit</th>
            <th>Aktionen</th>
        </tr>
        </thead>
        <tbody>
        {% for item in users %}
            <tr>
                <td colspan="6">
                    <form method="post" action="/admin/users/{{ item.id }}/update" class="user-form">
                        <input type="text" name="username" value="{{ item.username }}" required>
                        <input type="text" name="full_name" value="{{ item.full_name }}" required>
                        <input type="email" name="email" value="{{ item.email }}" required>
                        <input type="text" name="pin_code" value="{{ item.pin_code }}" pattern="\\d{4}" maxlength="4" required>
                        <input type="number" name="standard_daily_minutes" value="{{ item.standard_daily_minutes }}" min="1" step="1" required>
                        <select name="group_id">
                            <option value="">ohne Gruppe</option>
                            {% for group in groups %}
                                <option value="{{ group.id }}" {% if item.group and item.group.id == group.id %}selected{% endif %}>{{ group.name }}</option>
                            {% endfor %}
                        </select>
                        <div class="form-actions">
                            <button type="submit" class="button small">Aktualisieren</button>
                        </div>
                    </form>
                    <form method="post" action="/admin/users/{{ item.id }}/delete" class="inline-form" onsubmit="return confirm('Benutzer wirklich löschen?');">
                        <button type="submit" class="button danger small">Löschen</button>
                    </form>
                </td>
            </tr>
        {% else %}
            <tr><td colspan="6">Keine Benutzer vorhanden.</td></tr>
        {% endfor %}
        </tbody>
    </table>

    <h2>Neuen Benutzer anlegen</h2>
    <form method="post" action="/admin/users/create" class="user-form">
        <input type="text" name="username" placeholder="Loginname" required>
        <input type="text" name="full_name" placeholder="Anzeigename" required>
        <input type="email" name="email" placeholder="Email" required>
        <input type="text" name="pin_code" placeholder="4-stelliger PIN" pattern="\\d{4}" maxlength="4" required>
        <input type="number" name="standard_daily_minutes" value="480" min="1" step="1" required>
        <select name="group_id">
            <option value="">ohne Gruppe</option>
            {% for group in groups %}
                <option value="{{ group.id }}">{{ group.name }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="button primary">Benutzer anlegen</button>
    </form>
</section>
{% endblock %}
